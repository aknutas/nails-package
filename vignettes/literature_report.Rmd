---
title: "Literature Review"
author: "Juho Salminen"
date: "`r Sys.Date()`"
output: 
    rmarkdown::html_vignette:
        fig_width: 7
        fig_height: 5
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      message=FALSE, 
                      warning=FALSE)
```


```{r}
# Setup

# Load packages
devtools::load_all()
require(ggplot2)

# Set ggplot theme
theme_set(theme_minimal(12))

# Load data
literature <- read_wos_data("../tests/testthat/test_data")

# Clean data
literature <- clean_wos_data(literature)
```


This report provides an analysis on the records downloaded from [Web of Science](http://webofscience.com). The analysis identifies the important authors, journals, and keywords in the dataset based on the number of occurences and citation counts. A citation network of the provided records is created and used to identify the important papers according to their in-degree, total citation count and PageRank scores. The analysis finds also often-cited references that were not included in the original dataset downloaded from the Web of Science.

Reports can be generated by using the [online analysis service](http://hammer.nailsproject.net/), and the source code is available at [GitHub](https://github.com/aknutas/nails). Instructions and links to tutorial videos can be found at the [project page](https://aknutas.github.io/nails/). For further details see the following article: [Knutas, A., Hajikhani, A., Salminen, J., Ikonen, J., Porras, J., 2015. Cloud-Based Bibliometric Analysis Service for Systematic Mapping Studies. CompSysTech 2015](http://www.codecamp.fi/lib/exe/fetch.php/wiki/nails-compsystech2015-preprint.pdf). Please cite our research paper on bibliometrics if you publish the analysis results. Use is otherwise free.

The analysed dataset consist of `r nrow(literature)` records with `r ncol(literature)` variables. More information about the variables can be found at [Web of Science](https://images.webofknowledge.com/WOK46/help/WOS/h_fullrec.html).

## Publication years
```{r}
ggplot(literature, aes(YearPublished)) +
  geom_histogram(binwidth = 1, fill = "darkgreen") +
  ggtitle("Year published") +
  xlab("Year") +
  ylab("Article count")


# Calculate relative publication counts
# yearTable <- as.data.frame(table(literature$YearPublished))  
# names(yearDF) <- c("Year", "Freq")      # Fix column names

# Merge to dataframe of total publication numbers (years)
# yearDF <- merge(yearDF, years, by.x = "Year", by.y = "Year", 
#                all.x = TRUE)
# yearDF$Year <- as.numeric(as.character(yearDF$Year))    # factor to numeric
# Calculate published articles per total articles by year
# yearDF$Fraction <- yearDF$Freq / yearDF$Records
```

## Relative publication volume
```{r}
# ADD PLOT HERE!
print("Placeholder")
```

## Important authors
Sorted by the number of articles published and by the total number of citations.
```{r}
# Get author network nodes, which contain the required information
author_network <- get_author_network(literature)
author_nodes <- author_network$author_nodes
# Change Id to AuthorFullName
names(author_nodes)[names(author_nodes) == "Id"] <- "AuthorFullName"

# Sort by number of articles by author
author_nodes <- author_nodes[with (author_nodes, order(-Freq)), ]
# Re-order factor levels
author_nodes <- transform(author_nodes, 
                          AuthorFullName = reorder(AuthorFullName, Freq))

ggplot(head(author_nodes, 25), aes(AuthorFullName, Freq)) +
    geom_bar(stat = "identity", fill = "blue") +
    coord_flip() +
    ggtitle("Productive authors") +
    xlab("Author") +
    ylab("Number of articles")
```

```{r}
# Reorder AuthorFullName factor according to TotalTimesCited (decreasing order)
author_nodes <- transform(author_nodes,
                          AuthorFullName = reorder(AuthorFullName,
                                                   TotalTimesCited))

# Sort by number of articles by author
author_nodes <- author_nodes[with (author_nodes, order(-TotalTimesCited)), ]

ggplot(head(author_nodes, 25), aes(AuthorFullName, TotalTimesCited)) +
    geom_bar(stat = "identity", fill = "blue") +
    coord_flip() +
    ggtitle("Most cited authors") +
    xlab("Author") + ylab("Total times cited")
```


## Important publications
Sorted by number of published articles in the dataset and by the total number of citations.
```{r}
# Calculate publication occurences
publications <- as.data.frame(table(literature$PublicationName))

# Fix names
names(publications) <- c("Publication", "Count")

# Trim publication name to maximum of 50 characters for displaying in plot
publications$Publication <- strtrim(publications$Publication, 50)

# Sort descending
publications <- publications[with (publications, order(-Count)), ]

# Reorder factor levels
publications <- transform(publications, Publication = reorder(Publication, Count))


# WHY???
# literature <- merge(literature, citation_sums,
#                    by = "PublicationName" )

ggplot(head(publications, 25), aes(Publication, Count)) +
    geom_bar(stat = "identity", fill = "orange") +
    coord_flip() +
    theme(legend.position = "none") +
    ggtitle("Most popular publications") +
    xlab("Publication") +
    ylab("Article count")
```

```{r}
# Calculating total citations for each publication.
citation_sums <- aggregate(literature$TimesCited,
    by = list(PublicationName = literature$PublicationName),
    FUN = sum, na.rm = T)

# Fix column names
names(citation_sums) <- c("PublicationName", "PublicationTotalCitations")

# Trim publication name to maximum of 50 characters for displaying in plot
citation_sums$PublicationName <- strtrim(citation_sums$PublicationName, 50)

# Sort descending and reorder factor levels accordingly
citation_sums <- citation_sums[with (citation_sums, order(-PublicationTotalCitations)), ]
citation_sums <- transform(citation_sums,
                          PublicationName = reorder(PublicationName,
                                                    PublicationTotalCitations))
ggplot(head(citation_sums, 25),
       aes(PublicationName, PublicationTotalCitations)) +
    geom_bar(stat = "identity", fill = "orange") +
    coord_flip() +
    theme(legend.position = "none") +
    ggtitle("Most cited publications") +
    xlab("Publication") + ylab("Total times cited")

```

## Important keywords
Sorted by the number of articles where the keyword is mentioned and by the total number of citations for the keyword.
```{r}
# Calculating total citations for each keyword

literature_by_keywords <- arrange_by(literature, "AuthorKeywords")



# Sometimes AuthorKeywords column is empty.
# Following if-else hack prevents crashing in those situations,
# either by using KeywordsPlus column or skipping keyword analysis.
if (nrow(literature_by_keywords) == 0) {
  cat("No keywords.")
} else {
    keyword_citation_sum <- aggregate(literature_by_keywords$TimesCited,
                                by = list(AuthorKeywords =
                            literature_by_keywords$AuthorKeywords), FUN = sum,
                            na.rm = T)
    names(keyword_citation_sum) <- c("AuthorKeywords", "TotalTimesCited")
    
    keywords <- unlist(strsplit(literature$AuthorKeywords, ";"))
    keywords <- trim(keywords)
    keywords <- as.data.frame(table(keywords))
    names(keywords) <- c("AuthorKeywords", "Freq")
    
    keywords <- merge(keywords, keyword_citation_sum, by = "AuthorKeywords")
    keywords <- keywords[with (keywords, order(-Freq)), ]
    keywords <- transform(keywords, 
                          AuthorKeywords = reorder(AuthorKeywords, Freq))
    
    ggplot(head(keywords, 25), aes(AuthorKeywords, Freq)) +
    geom_bar(stat = "identity", fill = "purple") +
    coord_flip() +
    ggtitle("Popular keywords") +
    xlab("Keyword") +
    ylab("Number of occurences")
}
```

```{r}
if (nrow(literature_by_keywords) > 0) {
  keywords <- keywords[with (keywords, order(-TotalTimesCited)), ]
  keywords <- transform(keywords, AuthorKeywords =
                             reorder(AuthorKeywords, TotalTimesCited))
  ggplot(head(keywords, 25), aes(AuthorKeywords, TotalTimesCited)) +
    geom_bar(stat = "identity", fill = "purple") +
    coord_flip()  +
    ggtitle("Most cited keywords") +
    xlab("Keyword") + ylab("Total times cited")
}

```

## Important papers
The most important papers and other sources are identified below using three importance measures: 1) in-degree in the citation network, 2) citation count provided by Web of Science (only for papers included in the dataset), and 3) PageRank score in the citation network. The top 25 highest scoring papers are identified using these measures separately. The results are then combined and duplicates are removed. Results are sorted by in-degree, and ties are first broken by citation count and then by the PageRank.

When a [Digital Object Identifier (DOI)](http://www.doi.org/) is available, the full paper can be found using [Resolve DOI](https://dx.doi.org/) website.

```{r}
# Extract citation nodes
citation_network <- get_citation_network(literature)
citation_nodes <- citation_network$citation_nodes


# Extract the articles included in the data set and articles not included
# in the dataset
citations_lit <- citation_nodes[citation_nodes$Origin == "literature", ]
citations_ref <- citation_nodes[citation_nodes$Origin == "reference", ]

# Create article strings (document title, reference information and abstract
# separated by "|")
citations_lit$Article <- paste(toupper(citations_lit$DocumentTitle), " | ",
                              citations_lit$FullReference, " | ",
                                      citations_lit$Abstract)
```

### Included in the dataset
These papers were included in the `r nrow(literature)` records downloaded from the Web of Science.
```{r}
# Sort citations_lit by TimesCited, decreasing
citations_lit <- citations_lit[with (citations_lit, order(-TimesCited)), ]
# Extract top 25
top_lit <- head(citations_lit, 25)
# Sort by InDegree, decreasing
citations_lit <- citations_lit[with (citations_lit, order(-InDegree)), ]
# Add to list of top 25 most cited papers
top_lit <- rbind(top_lit, head(citations_lit, 25))
# Sort by PageRank, decreasing
citations_lit <- citations_lit[with (citations_lit, order(-PageRank)), ]
# Add to list of most cited and highest InDegree papers
top_lit <- rbind(top_lit, head(citations_lit, 25))
# Remove duplicates
top_lit <- top_lit[!duplicated(top_lit[, "FullReference"]), ]
# Sort top_lit by InDegree, break ties by TimesCited, then PageRank.
top_lit <- top_lit[with (top_lit, order(-InDegree, -TimesCited, -PageRank)), ]
# Print list
knitr::kable(top_lit[, c("Article", "InDegree", "TimesCited","PageRank")])
```

### Not included in the dataset
These papers and other references were not among the `r nrow(literature)` records downloaded from the Web of Science.
```{r}
# Sort citations_ref by InDegree, decreasing
citations_ref <- citations_ref[with (citations_ref, order(-InDegree)), ]
# Extract top 25
top_ref <- head(citations_ref, 25)
# Sort by PageRank, decreasing
citations_ref <- citations_ref[with (citations_ref, order(-PageRank)), ]
# Add to list of highes in degree papers (references)
top_ref <- rbind(top_ref, head(citations_ref, 25))
# Remove duplicates
top_ref <- top_ref[!duplicated(top_ref[, "FullReference"]), ]
# Sort by InDegree, break ties by PageRank
top_ref <- top_ref[with (top_ref, order(-InDegree, -PageRank)), ]
# Print results
knitr::kable(top_ref[, c("FullReference", "InDegree", "PageRank")])
```

## Most referenced publications
```{r}
references <- unlist(strsplit(literature$CitedReferences, ";"))

get_publication <- function(x) {
    publication <- "Not found"
    try(
        publication <- unlist(strsplit(x, ","))[[3]],
        silent = TRUE
    )
    return(publication)
}

refPublications <- sapply(references, get_publication)
refPublications <- sapply(refPublications, trim)
refPublications <- refPublications[refPublications != "Not found"]
refPublications <- as.data.frame(table(refPublications))
names(refPublications) <- c("Publication", "Count")
refPublications <- refPublications[with (refPublications, order(-Count)), ]

refPublications <- transform(refPublications,
                             Publication = reorder(Publication, Count))

ggplot(head(refPublications, 25), aes(Publication, Count)) +
    geom_bar(stat = "identity", fill = "orange") +
    coord_flip() +
    theme(legend.position = "none") +
    ggtitle("Most referenced publications") +
    xlab("Publication") +
    ylab("Count")
```

## Topic Model
```{r}
print("Placeholder")
```


