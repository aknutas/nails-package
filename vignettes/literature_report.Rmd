---
title: "Literature Review"
author: "Juho Salminen"
date: "`r Sys.Date()`"
output: 
    rmarkdown::html_vignette:
        fig_width: 7
        fig_height: 5
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      message=FALSE, 
                      results='hide', 
                      warning=FALSE)
```


```{r}
# Setup

# Load packages
devtools::load_all()
library(nails)
library(ggplot2)
library(knitr)
library(igraph)

# Set ggplot theme
theme_set(theme_minimal(12))

# Load data
literature <- read_wos_data("../tests/testthat/test_data")

# Clean data
literature <- clean_wos_data(literature)
```


This report provides an analysis on the records downloaded from [Web of Science](http://webofscience.com). The analysis identifies the important authors, journals, and keywords in the dataset based on the number of occurences and citation counts. A citation network of the provided records is created and used to identify the important papers according to their in-degree, total citation count and PageRank scores. The analysis finds also often-cited references that were not included in the original dataset downloaded from the Web of Science.

Reports can be generated by using the [online analysis service](http://hammer.nailsproject.net/), and the source code is available at [GitHub](https://github.com/aknutas/nails). Instructions and links to tutorial videos can be found at the [project page](https://aknutas.github.io/nails/). For further details see the following article: [Knutas, A., Hajikhani, A., Salminen, J., Ikonen, J., Porras, J., 2015. Cloud-Based Bibliometric Analysis Service for Systematic Mapping Studies. CompSysTech 2015](http://www.codecamp.fi/lib/exe/fetch.php/wiki/nails-compsystech2015-preprint.pdf). Please cite our research paper on bibliometrics if you publish the analysis results. Use is otherwise free.

The analysed dataset consist of `r nrow(literature)` records with `r ncol(literature)` variables. More information about the variables can be found at [Web of Science](https://images.webofknowledge.com/WOK46/help/WOS/h_fullrec.html).

## Publication years
```{r}
ggplot(literature, aes(YearPublished)) +
  geom_histogram(binwidth = 1, fill = "darkgreen") +
  ggtitle("Year published") +
  xlab("Year") +
  ylab("Article count")


# Calculate relative publication counts
# yearTable <- as.data.frame(table(literature$YearPublished))  
# names(yearDF) <- c("Year", "Freq")      # Fix column names

# Merge to dataframe of total publication numbers (years)
# yearDF <- merge(yearDF, years, by.x = "Year", by.y = "Year", 
#                all.x = TRUE)
# yearDF$Year <- as.numeric(as.character(yearDF$Year))    # factor to numeric
# Calculate published articles per total articles by year
# yearDF$Fraction <- yearDF$Freq / yearDF$Records
```

## Relative publication volume
```{r}
# ADD PLOT HERE!
print("Placeholder")
```

## Important authors
Sorted by the number of articles published and by the total number of citations.
```{r}
# Get author network nodes, which contain the required information
author_nodes <- get_author_nodes(literature)
# Change Id to AuthorFullName
names(author_nodes)[names(author_nodes) == "Id"] <- "AuthorFullName"

# Sort by number of articles by author
author_nodes <- author_nodes[with (author_nodes, order(-Freq)), ]
# Re-order factor levels
author_nodes <- transform(author_nodes, 
                          AuthorFullName = reorder(AuthorFullName, Freq))

ggplot(head(author_nodes, 25), aes(AuthorFullName, Freq)) +
    geom_bar(stat = "identity", fill = "blue") +
    coord_flip() +
    ggtitle("Productive authors") +
    xlab("Author") +
    ylab("Number of articles")
```

```{r}
# Reorder AuthorFullName factor according to TotalTimesCited (decreasing order)
author_nodes <- transform(author_nodes,
                          AuthorFullName = reorder(AuthorFullName,
                                                   TotalTimesCited))

ggplot(head(author_nodes, 25), aes(AuthorFullName, TotalTimesCited)) +
    geom_bar(stat = "identity", fill = "blue") +
    coord_flip() +
    ggtitle("Most cited authors") +
    xlab("Author") + ylab("Total times cited")
```


## Important publications
Sorted by number of published articles in the dataset and by the total number of citations.
```{r}
# Calculate publication occurences
publications <- as.data.frame(table(literature$PublicationName))

# Fix names
names(publications) <- c("Publication", "Count")

# Trim publication name to maximum of 50 characters for displaying in plot
publications$Publication <- strtrim(publications$Publication, 50)

# Sort descending
publications <- publications[with (publications, order(-Count)), ]

# Reorder factor levels
publications <- transform(publications, Publication = reorder(Publication, Count))


# WHY???
# literature <- merge(literature, citationSums,
#                    by = "PublicationName" )

ggplot(head(publications, 25), aes(Publication, Count)) +
    geom_bar(stat = "identity", fill = "orange") +
    coord_flip() +
    theme(legend.position = "none") +
    ggtitle("Most popular publications") +
    xlab("Publication") +
    ylab("Article count")
```

```{r}
# Calculating total citations for each publication.
citationSums <- aggregate(literature$TimesCited,
    by = list(PublicationName = literature$PublicationName),
    FUN = sum, na.rm = T)

# Fix column names
names(citationSums) <- c("PublicationName", "PublicationTotalCitations")

# Trim publication name to maximum of 50 characters for displaying in plot
citationSums$PublicationName <- strtrim(citationSums$PublicationName, 50)

# Sort descending and reorder factor levels accordingly
citationSums <- citationSums[with (citationSums, order(-PublicationTotalCitations)), ]
citationSums <- transform(citationSums,
                          PublicationName = reorder(PublicationName,
                                                    PublicationTotalCitations))
ggplot(head(citationSums, 25),
       aes(PublicationName, PublicationTotalCitations)) +
    geom_bar(stat = "identity", fill = "orange") +
    coord_flip() +
    theme(legend.position = "none") +
    ggtitle("Most cited publications") +
    xlab("Publication") + ylab("Total times cited")

```



